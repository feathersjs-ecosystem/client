!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.feathers=t():e.feathers=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){var r,o,i;!function(n,s){o=[],void 0!==(i="function"==typeof(r=s)?r.apply(t,o):r)&&(e.exports=i)}(0,function(){function e(e,t,n,r){return function(){var o=this._super;this._super="function"==typeof t?t:e[n];var i=r.apply(this,arguments);return this._super=o,i}}return{create:function(){var e=Object.create(this),t="string"==typeof e.__init?e.__init:"init";return"function"==typeof e[t]&&e[t].apply(e,arguments),e},mixin:"function"==typeof Object.defineProperty?function(t,n){var r=n||this,o=/\b_super\b/,i=Object.getPrototypeOf(r)||r.prototype,s={},c=t,u=function(e){s[e]||(s[e]=Object.getOwnPropertyDescriptor(c,e))};do{Object.getOwnPropertyNames(c).forEach(u)}while((c=Object.getPrototypeOf(c))&&Object.getPrototypeOf(c));return Object.keys(s).forEach(function(t){var n=s[t];"function"==typeof n.value&&o.test(n.value)&&(n.value=e(i,r[t],t,n.value)),Object.defineProperty(r,t,n)}),r}:function(t,n){var r,o=n||this,i=/\b_super\b/,s=Object.getPrototypeOf(o)||o.prototype;for(var c in t)r=o[c],("function"==typeof t[c]&&"function"==typeof s[c]||"function"==typeof r&&"function"==typeof t[c])&&i.test(t[c])?o[c]=e(s,r,c,t[c]):o[c]=t[c];return o},extend:function(e,t){return this.mixin(e,Object.create(t||this))},proxy:function(e){var t=this[e],n=Array.prototype.slice.call(arguments,1);return n.unshift(this),t.bind.apply(t,n)}}})},function(e,t,n){"use strict";(function(e){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.stripSlashes=function(e){return e.replace(/^(\/*)|(\/*)$/g,"")};var r=t._={each:function(e,t){e&&"function"==typeof e.forEach?e.forEach(t):r.isObject(e)&&Object.keys(e).forEach(function(n){return t(e[n],n)})},some:function(e,t){return Object.keys(e).map(function(t){return[e[t],t]}).some(function(e){var n=e[0],r=e[1];return t(n,r)})},every:function(e,t){return Object.keys(e).map(function(t){return[e[t],t]}).every(function(e){var n=e[0],r=e[1];return t(n,r)})},keys:function(e){return Object.keys(e)},values:function(e){return r.keys(e).map(function(t){return e[t]})},isMatch:function(e,t){return r.keys(t).every(function(n){return e[n]===t[n]})},isEmpty:function(e){return 0===r.keys(e).length},isObject:function(e){return"object"===(void 0===e?"undefined":n(e))&&!Array.isArray(e)&&null!==e},extend:function(){return Object.assign.apply(Object,arguments)},omit:function(e){for(var t=r.extend({},e),n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return o.forEach(function(e){return delete t[e]}),t},pick:function(e){for(var t={},n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(function(n){t[n]=e[n]}),t},merge:function(e,t){return r.isObject(e)&&r.isObject(t)&&Object.keys(t).forEach(function(n){if(r.isObject(t[n])){if(!e[n]){var o;Object.assign(e,(o={},o[n]={},o))}r.merge(e[n],t[n])}else{var i;Object.assign(e,(i={},i[n]=t[n],i))}}),e}};t.select=function(e){for(var t=e&&e.query&&e.query.$select,n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];Array.isArray(t)&&o.length&&t.push.apply(t,o);var s=function(e){return Array.isArray(t)?r.pick.apply(r,[e].concat(t)):e};return function(e){return Array.isArray(e)?e.map(s):s(e)}},t.sorter=function(e){return function(t,n){var o=0;return r.each(e,function(e,r){e=parseInt(e,10),t[r]<n[r]&&(o-=1*e),t[r]>n[r]&&(o+=1*e)}),o}},t.isPromise=function(e){return r.isObject(e)&&"function"==typeof e.then},t.makeUrl=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o="function"==typeof r.get?r.get.bind(r):function(){},i=o("env")||"production",s=o("host")||e.env.HOST_NAME||"localhost",c="development"===i||"test"===i||void 0===i?"http":"https",u=o("port")||e.env.PORT||3030;return n=n||"",c+"://"+s+("development"===i||"test"===i||void 0===i?":"+u:"")+"/"+t.stripSlashes(n)}}).call(t,n(2))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(a===setTimeout)return setTimeout(e,0);if((a===n||!a)&&setTimeout)return a=setTimeout,setTimeout(e,0);try{return a(e,0)}catch(t){try{return a.call(null,e,0)}catch(t){return a.call(this,e,0)}}}function i(){v&&h&&(v=!1,h.length?l=h.concat(l):d=-1,l.length&&s())}function s(){if(!v){var e=o(i);v=!0;for(var t=l.length;t;){for(h=l,l=[];++d<t;)h&&h[d].run();d=-1,t=l.length}h=null,v=!1,function(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var a,f,p=e.exports={};!function(){try{a="function"==typeof setTimeout?setTimeout:n}catch(e){a=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var h,l=[],v=!1,d=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new c(e,t)),1!==l.length||v||o(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(1),o=n(11),i=n(12),s=n(13);e.exports=Object.assign({},r,i,{hooks:o,filterQuery:s})},function(e,t,n){"use strict";e.exports="3.0.5"},function(e,t,n){"use strict";e.exports=n(6)},function(e,t,n){"use strict";function r(){var e={};return o.mixin(i,e),e.init(),e}var o=n(0),i=n(7),s=n(4);r.version=s,e.exports=r,e.exports.default=r},function(e,t,n){"use strict";var r=n(8)("feathers:application"),o=n(3).stripSlashes,i=n(0),s=n(14),c=n(16),u=n(4),a=i.extend({create:null}),f={init:function(){Object.assign(this,{version:u,methods:["find","get","create","update","patch","remove"],mixins:[],services:{},providers:[],_setup:!1,settings:{}}),this.configure(c()),this.configure(s())},get:function(e){return this.settings[e]},set:function(e,t){return this.settings[e]=t,this},disable:function(e){return this.settings[e]=!1,this},disabled:function(e){return!this.settings[e]},enable:function(e){return this.settings[e]=!0,this},enabled:function(e){return!!this.settings[e]},configure:function(e){return e.call(this,this),this},service:function(e,t){if(void 0!==t)throw new Error("Registering a new service with `app.service(path, service)` is no longer supported. Use `app.use(path, service)` instead.");var n=o(e),r=this.services[n];return void 0===r&&"function"==typeof this.defaultService?this.use("/"+n,this.defaultService(n)).service(n):r},use:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e||""===o(e))throw new Error("'"+e+"' is not a valid service path.");var s=o(e),c="function"==typeof t.service&&t.services,u=this.methods.concat("setup").some(function(e){return t&&"function"==typeof t[e]});if(c){var f=t;return Object.keys(f.services).forEach(function(e){return n.use(s+"/"+e,f.service(e))}),this}if(!u)throw new Error("Invalid service object passed for path `"+s+"`");var p=a.isPrototypeOf(t)?t:a.extend(t);return r("Registering new service at `"+s+"`"),this.mixins.forEach(function(e){return e.call(n,p,s,i)}),"function"==typeof p._setup&&p._setup(this,s),this.providers.forEach(function(e){return e.call(n,p,s,i)}),this._isSetup&&"function"==typeof p.setup&&(r("Setting up service for `"+s+"`"),p.setup(this,s)),this.services[s]=p,this},setup:function(){var e=this;return Object.keys(this.services).forEach(function(t){var n=e.services[t];r("Setting up service for `"+t+"`"),"function"==typeof n.setup&&n.setup(e,t)}),this._isSetup=!0,this}};e.exports=f},function(e,t,n){(function(r){function o(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(9)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())}).call(t,n(2))},function(e,t,n){function r(e){function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var s=new Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var o=t.formatters[r];if("function"==typeof o){var i=s[u];n=o.call(e,i),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s);(n.log||t.log||console.log.bind(console)).apply(e,s)}}var r;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(10),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var r=1e3,o=60*r,i=60*o,s=24*i,c=365.25*s;e.exports=function(e,t){t=t||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===u&&!1===isNaN(e))return t.long?function(e){return n(e,s,"day")||n(e,i,"hour")||n(e,o,"minute")||n(e,r,"second")||e+" ms"}(e):function(e){return e>=s?Math.round(e/s)+"d":e>=i?Math.round(e/i)+"h":e>=o?Math.round(e/o)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";function r(e){var t=e[0],n=e[1];return{id:t,params:void 0===n?{}:n}}function o(e){var t=e[0],n=e[1],r=e[2];return{id:t,data:n,params:void 0===r?{}:r}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(1)._.each;t.converters={find:function(e){var t=e[0];return{params:void 0===t?{}:t}},create:function(e){var t=e[0],n=e[1];return{data:t,params:void 0===n?{}:n}},get:r,remove:r,update:o,patch:o},t.createHookObject=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.converters[e](n);return Object.assign(o,r,{method:e,get path(){var e=r.app,t=r.service;return t&&e&&e.services?Object.keys(e.services).find(function(n){return e.services[n]===t}):null}})},t.defaultMakeArguments=function(e){var t=[];return void 0!==e.id&&t.push(e.id),e.data&&t.push(e.data),t.push(e.params||{}),t},t.makeArguments=function(e){switch(e.method){case"find":return[e.params];case"get":case"remove":return[e.id,e.params];case"update":case"patch":return[e.id,e.data,e.params];case"create":return[e.data,e.params]}return t.defaultMakeArguments(e)},t.convertHookData=function(e){var t={};return Array.isArray(e)?t={all:e}:"object"!==(void 0===e?"undefined":i(e))?t={all:[e]}:s(e,function(e,n){t[n]=Array.isArray(e)?e:[e]}),t},t.isHookObject=function(e){return"object"===(void 0===e?"undefined":i(e))&&"string"==typeof e.method&&"string"==typeof e.type},t.getHooks=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=e.__hooks[n][r]||[],s=t.__hooks[n][r]||[];return o?s.concat(i):i.concat(s)},t.processHooks=function(e,n){var r=this,o=n,i=function(e){if(e){if(!t.isHookObject(e))throw new Error(o.type+" hook for '"+o.method+"' method returned invalid hook object");o=e}return o},s=Promise.resolve(o);return e.forEach(function(e){var t=e.bind(r);s=2===t.length?s.then(function(e){return new Promise(function(n,r){t(e,function(e,t){return e?r(e):n(t)})})}):s.then(t),s=s.then(i)}),s.catch(function(e){throw e.hook=o,e})},t.enableHooks=function(e,n,r){if("function"==typeof e.hooks)return e;var o={};return r.forEach(function(e){o[e]={}}),Object.defineProperty(e,"__hooks",{value:o}),Object.assign(e,{hooks:function(e){var r=this;return s(e,function(e,o){if(!r.__hooks[o])throw new Error("'"+o+"' is not a valid hook type");var i=t.convertHookData(e);s(i,function(e,t){if("all"!==t&&-1===n.indexOf(t))throw new Error("'"+t+"' is not a valid hook method")}),n.forEach(function(e){var t=r.__hooks[o][e]||(r.__hooks[o][e]=[]);i.all&&t.push.apply(t,i.all),i[e]&&t.push.apply(t,i[e])})}),this}})}},function(e,t,n){"use strict";function r(e){return"object"===(void 0===e?"undefined":o(e))&&null!==e}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i={find:1,get:2,create:2,update:3,patch:3,remove:2};t.validateArguments=function(e,t){if("function"==typeof t[t.length-1])throw new Error("Callbacks are no longer supported. Use Promises or async/await instead.");var n=i[e];if(n&&t.length>n)throw new Error("Too many arguments for '"+e+"' method");var o=t[n-1];if(void 0!==o&&!r(o))throw new Error("Params for '"+e+"' method must be an object");switch(e){case"create":if(!r(t[0]))throw new Error("A data object must be provided to the 'create' method");break;case"get":case"remove":case"update":case"patch":if(void 0===t[0])throw new Error("An id must be provided to the '"+e+"' method");if(("update"===e||"patch"===e)&&!r(t[1]))throw new Error("A data object must be provided to the '"+e+"' method")}return!0}},function(e,t,n){"use strict";function r(e){if(void 0!==e)return Math.abs(parseInt(e,10))}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(1)._,s=["$sort","$limit","$skip","$select","$populate"];e.exports=function(e,t){return{filters:{$sort:function(e){if("object"!==(void 0===e?"undefined":o(e)))return e;var t={};return Object.keys(e).forEach(function(n){t[n]="object"===o(e[n])?e[n]:parseInt(e[n],10)}),t}(e.$sort),$limit:function(e,t){if(t&&t.default){var n="number"==typeof e?e:t.default,r="number"==typeof t.max?t.max:Number.MAX_VALUE;return Math.min(n,r)}return e}(r(e.$limit),t),$skip:r(e.$skip),$select:e.$select,$populate:e.$populate},query:i.omit.apply(i,[e].concat(s))}}},function(e,t,n){"use strict";var r=n(15).EventEmitter,o=n(0),i=t.eventHook=function(){return function(e){var t=e.app,n=e.service,r=t.eventMappings[e.method],o=n._hookEvents&&-1!==n._hookEvents.indexOf(r);if(r&&o&&"error"!==e.type){(Array.isArray(e.result)?e.result:[e.result]).forEach(function(t){return n.emit(r,t,e)})}}},s=t.eventMixin=function(e){if(!e._serviceEvents){var t=this,n="function"==typeof e.on&&"function"==typeof e.emit;"function"!=typeof e.mixin||n||e.mixin(r.prototype),Object.defineProperties(e,{_serviceEvents:{value:Array.isArray(e.events)?e.events.slice():[]},_hookEvents:{value:[]}}),Object.keys(t.eventMappings).forEach(function(n){var r=t.eventMappings[n],o=-1!==e._serviceEvents.indexOf(r);"function"!=typeof e[n]||o||(e._serviceEvents.push(r),e._hookEvents.push(r))})}};e.exports=function(){return function(e){Object.assign(e,{eventMappings:{create:"created",update:"updated",remove:"removed",patch:"patched"}}),e.hooks({finally:i()}),o.mixin(r.prototype,e),e.mixins.push(s)}}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,s,c,u,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(n=this._events[e],i(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),n.apply(this,c)}else if(o(n))for(c=Array.prototype.slice.call(arguments,1),s=(a=n.slice()).length,u=0;u<s;u++)a[u].apply(this,c);return!0},n.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(s=i(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,c;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(c=s;c-- >0;)if(n[c]===t||n[c].listener&&n[c].listener===t){i=c;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";var r=n(3),o=r.hooks,i=r.validateArguments,s=r.isPromise,c=o.createHookObject,u=o.getHooks,a=o.processHooks,f=o.enableHooks,p=o.makeArguments,h=t.hookMixin=function(e){if("function"!=typeof e.hooks){var t=this,n=t.methods,r={};f(e,n,t.hookTypes),n.forEach(function(n){"function"==typeof e[n]&&(r[n]=function(){var e=this,r=Array.from(arguments),o=!0===r[r.length-1]&&r.pop();try{i(n,r)}catch(e){return Promise.reject(e)}var f=e._super.bind(e),h=c(n,r,{type:"before",service:e,app:t}),l=u(t,e,"before",n);return a.call(e,l,h).then(function(e){if(void 0!==e.result)return e;var t=f.apply(void 0,p(e));if(!s(t))throw new Error("Service method '"+e.method+"' for '"+e.path+"' service must return a promise");return t.then(function(t){return e.result=t,e})}).then(function(e){return Object.assign({},e,{type:"after"})}).then(function(r){var o=u(t,e,"after",n,!0),i=u(t,e,"finally",n,!0),s=o.concat(i);return a.call(e,s,r)}).then(function(e){return o?e:e.result}).catch(function(r){var i=u(t,e,"error",n,!0),s=u(t,e,"finally",n,!0),c=i.concat(s),f=Object.assign({},r.hook||h,{type:"error",result:null,original:r.hook,error:r});return a.call(e,c,f).then(function(e){return o?e.result?e:Promise.reject(e):e.result?e.result:Promise.reject(e.error)})})})}),e.mixin(r)}};e.exports=function(){return function(e){Object.assign(e,{hookTypes:["before","after","error","finally"]}),f(e,e.methods,e.hookTypes),e.mixins.push(h)}}}])});